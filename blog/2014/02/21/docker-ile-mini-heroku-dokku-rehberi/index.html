
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Docker ile mini-Heroku : Dokku Rehberi - Aydın Doyak</title>
  <meta name="author" content="Aydın Doyak">

  
  <meta name="description" content="Dokku, Docker ile geliştirilmiş, 100 satır civarında Bash koduyla provision edilen bir mini-Heroku, teknik adıyla PaaS projesidir.
Kısaca bir sunucu &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://aydintd.me/blog/2014/02/21/docker-ile-mini-heroku-dokku-rehberi">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Aydın Doyak" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'> 


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37492706-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Aydın Doyak</a></h1>
  
    <h2>aydintd@eagle:~$ echo 'Technical, Personal Blog!'</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:aydintd.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Arşiv</a></li>
  <li><a href="/hakkimda">Hakkımda</a></li>
  <li><a href="http://fo.aydintd.me">Folyo</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Docker Ile mini-Heroku : Dokku Rehberi</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-21T23:17:00+02:00" pubdate data-updated="true">Feb 21<span>st</span>, 2014</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Dokku, Docker ile geliştirilmiş, 100 satır civarında Bash koduyla provision edilen bir mini-Heroku, teknik adıyla PaaS projesidir.
Kısaca bir sunucu makine üzerinde Dokku habitatını sağladıktan sonra, Heroku uyumlu uygulamaları &ldquo;git&rdquo; yardımıyla sunucuya &ldquo;push&rdquo; ettiğiniz
esnek bir yapıyı kullanıma sunar. Pushladığınız uygulama, içeride Heroku Buildpack&#8217;lerini kullanarak kurulur ve
birbirinden izole Docker konteynırları içerisinde yaşamaya başlarlar. Sonuç olarak; size özel, tek merkezli bir Heroku&#8217;ya sahip olursunuz.</p>

<p>Dokku&#8217;nun tabiri yerindeyse hamal işini yapan 3 ağır işçisi var : Docker, Buildstep ve sshcommand(gitreceive)</p>

<ul>
<li><p><a href="http://docker.io/" title="Docker">Docker</a> : Linux ortamlarında, hafif, güçlü, kendi kendine yeten konteynırlar oluşturmaya yarayan
açık kaynaklı bir projedir. Geliştiricilerin uygulamalarını laptoplarında, bare metal sunucularda, ürün makinelerinde,
bulut sistemlerde, hatta sanal makinelerde dahi hızla test edebilmeleri, ürün servis edebilmelerine
olanak sağlayan bir &ldquo;container runtime&rdquo; projesidir.</p></li>
<li><p><a href="https://github.com/progrium/buildstep" title="Buildstep">Buildstep</a> : Heroku&#8217;nun açık kaynaklı &ldquo;buildpack&#8221;lerini; uygulamaların,
üzerine kurulacağı temel imajı inşa etmek amacıyla kullanan bir inşaat aracıdır. Projenin adının &#8220;Docker + Heroku = Dokku&rdquo; olmasının sebebi aslında buradan kaynaklı.</p></li>
<li><p><a href="https://github.com/progrium/sshcommand" title="Sshcommand">Sshcommand</a> : Heroku&#8217;dan aşina olduğumuz &ldquo;push&rdquo; mekanizmasını Dokku&#8217;ya kazandıran bir projedir.Size bir &ldquo;git&rdquo; kullanıcısı sağlayıp, bu kullanıcı üzerinden Dokku&#8217;ya depo push etmenize olanak sağlar.</p></li>
</ul>


<p>Gel gelelim hikayeden sonra işin zevkli kısmına.</p>

<h2>Dokku Kurulumu</h2>

<p>Ben bu rehberde kendi yerelinizde Dokku&#8217;yla nasıl oynayabileceğinizi anlatacağımdan dolayı deponun içerisinde hazır gelen Vagrant makinesi yoluyla kurulum yolunu izleyeceğim.</p>

<p>Dokku&#8217;nun Vagrant makinesi Ubuntu 13.04 Raring Ringtail sürümü ile geliyor. Dokku kurulumunu sanal bir makinede yapacaksanız, Ubuntu 13 serisi işletim sistemi olarak tavsiye ediliyor.</p>

<p>Ben bu rehberde <a href="https://github.com/progrium/dokku" title="Dokku">Dokku</a>&lsquo;nun kurulumu ve daha önceden Node.js ile hazırlanmış bir &ldquo;Hello World!&rdquo; uygulamasının Dokku&#8217;ya nasıl push edileceğini anlatacağım.</p>

<!-- more -->


<h3>Geliştirme Ortamının Sağlanması</h3>

<p>Geliştirme ortamını hazırlarken, Dokku&#8217;yu Vagrant makinesi yardımıyla kuracağımdan, çalıştığınız host makinede &ldquo;vagrant, buna bağlı olarak
virtualbox ve git&rdquo; kurulu olduğundan emin olun. Aksi halde kurulumu takip edemezsiniz.</p>

<h3>Dokku klonlanması ve Yerel Ağ Ayarları</h3>

<p>Çalışma ortamınıza Dokku&#8217;yu klonlayın :</p>

<p><code>$ git clone git@github.com:progrium/dokku.git</code></p>

<p><code>$ cd dokku</code></p>

<p>Gördüğünüz üzere Dokku deposu halihazırda bir Vagrantfile ile gereken tüm ayarlarla beraber geliyor.</p>

<p>İçeriğine göz atacak olursak :</p>

<pre><code>BOX_NAME = ENV["BOX_NAME"] || "raring"
BOX_URI = ENV["BOX_URI"] || "https://cloud-images.ubuntu.com/vagrant/raring/current/raring-server-cloudimg-amd64-vagrant-disk1.box"
BOX_MEMORY = ENV["BOX_MEMORY"] || "512"
DOKKU_DOMAIN = ENV["DOKKU_DOMAIN"] || "dokku.me"
DOKKU_IP = ENV["DOKKU_IP"] || "10.0.0.2"
PREBUILT_STACK_URL = File.exist?("#{File.dirname(__FILE__)}/stack.tgz") ? 'file:///root/dokku/stack.tgz' : nil

make_cmd = "make install"
if PREBUILT_STACK_URL
  make_cmd = "PREBUILT_STACK_URL='#{PREBUILT_STACK_URL}' #{make_cmd}"
end
...
..
</code></pre>

<p>Dokku&#8217;nun Ubuntu sunucularından raring imajı temel kutu olarak indirilip, &ldquo;dokku.me&rdquo; domain adıyla 10.0.0.2 sanal ip&#8217;sinde çalışacak şekilde ayarlanmış
olduğunu görüyoruz. Dilerseniz domain adını, makine&#8217;nin ip&#8217;sini dilediğiniz şekilde değiştirebilirsiniz. Ben tembellik edip bu şekilde bırakacağım.
Değişiklik yaparsanız aşağıda anlatılanlar üzerinde değişikliklerinizi yapmayı da unutmayın.</p>

<p>Vagrantfile&#8217;da tanımlı bilgilere göre, Dokku çalıştığında makineye ulaşabilmeniz için yerelinizde aşağıdaki değişiklikleri yapmanız gerekiyor :</p>

<p><code>$ vim /etc/hosts</code></p>

<pre><code>...
..
10.0.0.2 dokku.me
10.0.0.2 node-js-sample.dokku.me
</code></pre>

<p>Bu satırları hosts tanımı olarak girdiğinizde, yerel makinenizden sanal Dokku sunucunuza erişebilir olacaksınız.
İkinci satırı, Dokku&#8217;ya push edilen uygulamaya ulaşabilmek için giriyoruz. Tamamen DNS olayı.</p>

<h3>Kutu Ateşleme</h3>

<p>Son olarak, dokku dizini içerisinde vagrant makinesini ayağa kaldırıyoruz :</p>

<p><code>$ vagrant up</code></p>

<pre><code>Bringing machine 'default' up with 'virtualbox' provider...
[default] Importing base box 'raring'...
[default] Matching MAC address for NAT networking...
[default] Setting the name of the VM...
[default] Clearing any previously set forwarded ports...
[default] Clearing any previously set network interfaces...
[default] Preparing network interfaces based on configuration...
[default] Forwarding ports...
[default] -- 22 =&gt; 2222 (adapter 1)
[default] -- 80 =&gt; 8080 (adapter 1)
[default] Running 'pre-boot' VM customizations...
[default] Booting VM...
[default] Waiting for machine to boot. This may take a few minutes...
[default] Machine booted and ready!
[default] Setting hostname...
[default] Configuring and enabling network interfaces...
[default] Mounting shared folders...
[default] -- /vagrant
[default] -- /root/dokku
[default] Running provisioner: shell...
[default] Running: inline script
Reading package lists...
Building dependency tree...
Reading state information...
...
</code></pre>

<p>Burada önemli olan, makine boot olduktan sonra Dokku ortamının bash betikleriyle provision ediliyor olması. Makine kurulumu bittikten sonra, makinenin içerisinde docker, buildpack ve sshcommand kurulumları yapılmış ve Dokku habitatı kullanıma hazır hale gelmiş olacak.</p>

<p>Kurulum sonunda makineye ssh&#8217;la bağlanabiliyor olmalısınız :</p>

<p><code>$ vagrant ssh</code></p>

<p>Makine içerisine girdikten sonra aşağıdaki komutu vererek makinenin doğru şekilde hazırlandığından emin olun :</p>

<pre><code>$ docker --version 
&gt; Docker version 0.8.1, build a1598d1
</code></pre>

<p>Eğer makineye bağlanamıyorsanız, kutu ayakta değil demektir. Aşağıdaki komutla kutuyu yeniden up etmeyi deneyin :</p>

<p><code>$ vagrant reload</code></p>

<p>Makineye bağlanabiliyor ancak docker gibi gerekli programların makineye kurulmadığını düşünüyorsanız :</p>

<p><code>$ vagrant provision</code></p>

<p>Eğer hiç bir sıkıntı yoksa, tebrikler mini minnacık bir Heroku&#8217;nuz meydana geldi :&ndash;)</p>

<h2>Dokku&#8217;ya Uygulama Konuşlandırma</h2>

<p>Rehberin ikinci ayağı, ektiğinizi biçeceğiniz bölüm burası.</p>

<p>Dokku&#8217;ya uygulama konuşlandırabilmeniz için, kullanıcınızın RSA açık anahtarının Dokku&#8217;ya bildirilmesi gerekiyor.
Böylece Dokku sizi tanıyacak ve sizden gelen depoları konteynırlara yerleştirecek.</p>

<p>Aşağıdaki komutu yerelinizde verin :</p>

<p><code>$ cat ~/.ssh/id_rsa.pub | ssh vagrant@dokku.me "sudo sshcommand acl-add dokku &lt;aydintd&gt;</code></p>

<p>Parola istediğinde, öntanımlı &lsquo;vagrant&rsquo; parolasını girin. aydintd yerine kendi kullanıcınızın ismini yazın.</p>

<p>Dokku&#8217;ya parola aracılığıyla erişmeye çalışırken :</p>

<pre><code>Permission denied (publickey)
</code></pre>

<p>gibi bir hata alabilirsiniz. Bu vagrant kutusuyla alakalı bir bug, elle düzeltmek gerekiyor :</p>

<p>Dokku sunucusuna bağlanıp, aşağıdaki adımları takip edin :</p>

<pre><code>$ sudo vim /etc/ssh/sshd_config

PasswordAuthentication yes   &lt;bu girdiyi yes olarak değiştirin&gt;

$ sudo service ssh restart
</code></pre>

<p>Makineden çıkıp açık anahtarınızı sunucuya tekrar göndermeyi deneyin.</p>

<p>Şu şekilde bir çıktı görüyorsanız başarıyla anahtarınızı sunucuya gönderdiniz demektir :</p>

<pre><code>$ cat ~/.ssh/id_rsa.pub | ssh root@dokku.me "sudo sshcommand acl-add dokku aydintd"
root@dokku.me's password: 
xx:3x:x6:xf:xe:f3:xx:xx:xx:xx:aa:cc:12:34:56:71
</code></pre>

<p>Son olarak <a href="http://github.com/heroku/node-js-sample" title="Buradaki">Buradaki</a> Node.js uygulamasını Dokku&#8217;ya konuşlandıralım :</p>

<p>Linkteki depoyu yerelinize klonladıktan sonra, aşağıdaki adımları takip edin :</p>

<p><code>$ cd node-js-sample</code></p>

<p><code>$ git remote add aydintd dokku@dokku.me:node-js-sample</code></p>

<p><code>$ git push aydintd master</code></p>

<p>Böylece uygulamanızı Dokku&#8217;ya push ediyorsunuz. Çıktıların en sonuna bakacak olursanız :</p>

<pre><code>-----&gt; Building runtime environment
-----&gt; Discovering process types
    Procfile declares types -&gt; web
-----&gt; Releasing node-js-sample ...
-----&gt; Deploying node-js-sample ...
=====&gt; Application deployed:
    http://node-js-sample.dokku.me

To dokku@dokku.me:node-js-sample
[new branch]      master -&gt; master
</code></pre>

<p><a href="http://node-js-sample.dokku.me">http://node-js-sample.dokku.me</a> adresini tarayıcınızda görüntülediğinizde Hello World! yazısını görüyorsanız başarıyla uygulamanızı Dokku&#8217;da konuşlandırdınız demektir.</p>

<h2>Dokku Dünyasına Merhaba Diyemediyseniz  :</h2>

<p>Herşeyden önce Dokku&#8217;ya bağlanıp, uygulamanızın varlığını kontrol edin :</p>

<p><code>$ sudo docker ps</code></p>

<pre><code>CONTAINER ID        IMAGE                       COMMAND                CREATED             STATUS              PORTS                     NAMES
01510b674a70        app/node-js-sample:latest   /bin/bash -c /start    6 minutes ago       Up 6 minutes        0.0.0.0:49153-&gt;5000/tcp   thirsty_euclid
</code></pre>

<p>Yukarıdaki gibi bir girdi görüyorsanız, uygulamanız konteynır hale getirilmiş demektir. Eğer bu girdiyi görüyor ancak tarayıcınızda Hello World! yazısıgöremiyorsanız tarayıcınıza <code>dokku.me:49153</code> yazmayı deneyin. Eğer bu şekilde görüntüleyebiliyorsanız, uygulamanızın nginx ayarları doğru çalışmıyor diyebilirsiniz.</p>

<p>Dokku&#8217;da her uygulama <code>/home/dokku/project-name</code> olarak konuşlanır. Bu dizin içerisindeki ayarlarla oynayarak debugging yapabilirsiniz.</p>

<p>Hepsi bu kadar :&ndash;)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Aydın Doyak</span></span>

      








  


<time datetime="2014-02-21T23:17:00+02:00" pubdate data-updated="true">Feb 21<span>st</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/teknik/'>Teknik</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://aydintd.me/blog/2014/02/21/docker-ile-mini-heroku-dokku-rehberi/" data-via="aydintd_" data-counturl="http://aydintd.me/blog/2014/02/21/docker-ile-mini-heroku-dokku-rehberi/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/08/25/logical-volume-manager-lvm-rehberi/" title="Previous Post: Logical Volume Manager (LVM) Rehberi">&laquo; Logical Volume Manager (LVM) Rehberi</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/02/21/docker-ile-mini-heroku-dokku-rehberi/">Docker Ile mini-Heroku : Dokku Rehberi</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/25/logical-volume-manager-lvm-rehberi/">Logical Volume Manager (LVM) Rehberi</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/25/redhat-scientific-linux-centos-sanal-makine-klonlanirken-eth0-ag-arayuzu-hatasinin-duzeltilmesi/">RedHat Scientific Linux CentOS Sanal Makine Klonlarının Eth0 ağ Arayüzü Hatasının Düzeltilmesi</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/21/yeniden-merhaba/">Yeniden Merhaba!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/26/ubuntuda-java-ee-uygulamalar%C4%B1-i%C3%A7in-apache-tomcat7-uygulama-sunucusunun-kurulumu/">Ubuntuda Java EE Uygulamaları Için Apache Tomcat7 Uygulama Sunucusunun Kurulumu</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/aydintd">@aydintd</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'aydintd',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/aydintd?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Aydın Doyak -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'aydintd';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://aydintd.me/blog/2014/02/21/docker-ile-mini-heroku-dokku-rehberi/';
        var disqus_url = 'http://aydintd.me/blog/2014/02/21/docker-ile-mini-heroku-dokku-rehberi/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
